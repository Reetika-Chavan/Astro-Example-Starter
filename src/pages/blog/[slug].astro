---
import Layout from '../../layouts/Layout.astro';

// Get the slug from the URL parameters
const { slug } = Astro.params;

// Redirect if no slug provided (Astro will show default 404)
if (!slug) {
  return new Response(null, { status: 404 });
}

// Simulate a database or content fetch (runs on server per request)
const posts: Record<string, { title: string; content: string; date: string }> = {
  'hello-world': {
    title: 'Hello World Post',
    content: 'This is a dynamically rendered blog post!',
    date: '2025-01-01'
  },
  'ssr-test': {
    title: 'SSR Test Post', 
    content: 'This content was fetched server-side based on the URL slug.',
    date: '2025-01-02'
  }
};

const post = posts[slug];
const requestTime = new Date().toLocaleString();

if (!post) {
  return new Response(null, { status: 404 });
}
---

<Layout>
  <article style="padding: 2rem; font-family: sans-serif; max-width: 800px; margin: 0 auto;">
    <header style="border-bottom: 1px solid #eee; padding-bottom: 1rem; margin-bottom: 2rem;">
      <h1 style="color: #333; margin-bottom: 0.5rem;">{post.title}</h1>
      <p style="color: #666; margin: 0;">Published: {post.date}</p>
      <p style="color: #999; font-size: 0.9em;">Server rendered at: {requestTime}</p>
    </header>
    
    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
      <h3>SSR Demo Info:</h3>
      <ul>
        <li><strong>URL slug:</strong> {slug}</li>
        <li><strong>Generated at:</strong> {requestTime}</li>
        <li><strong>This content was:</strong> Server-side rendered per request</li>
      </ul>
    </div>
    
    <div style="line-height: 1.6;">
      <p>{post.content}</p>
      <p>This demonstrates server-side routing, parameter extraction, conditional logic, and dynamic content rendering - all happening on the server before sending to the browser.</p>
    </div>
    
    <nav style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #eee;">
      <a href="/">‚Üê Home</a> | 
      <a href="/ssrtest">Basic SSR Test</a>
    </nav>
  </article>
</Layout> 